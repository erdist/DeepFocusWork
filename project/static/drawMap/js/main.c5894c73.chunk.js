(this.webpackJsonpreact_draw_company_map=this.webpackJsonpreact_draw_company_map||[]).push([[0],{280:function(e,a,t){e.exports=t(567)},567:function(e,a,t){"use strict";t.r(a);var n=t(0),r=t.n(n),o=t(36),l=t.n(o),s=t(28),i=t.n(s),c=t(26),d=t(61),p=t(48),u=t(49),y=t(51),g=t(50),h=t(52),f=t(157),v=(n.Component,t(86)),m=t(581),w=t(580),b=t(578),x=t(577),k=t(75),S=t(247),O=t(251),E=t(159),I=t.n(E),C=function(e){function a(){var e,t;Object(p.a)(this,a);for(var n=arguments.length,o=new Array(n),l=0;l<n;l++)o[l]=arguments[l];return(t=Object(y.a)(this,(e=Object(g.a)(a)).call.apply(e,[this].concat(o)))).state={uploading:!1,inputValues:{name:"",email:"",password:""},addUserOpened:!1,isError:!1,users:[]},t.fileInput=r.a.createRef(),t.onChange=function(e){var a=t.props.isReadyToSaveHaveHandler;if(1===e.target.files.length){var n=t.props.changeImage;t.setState({uploading:!0});var r=e.target.files[0].name,o=URL.createObjectURL(e.target.files[0]);fetch(o,{method:"GET"}).then((function(e){return e.blob()})).then((function(e){var l=new FileReader;l.readAsDataURL(e),l.onload=function(){n(o,l.result,r).then((function(){t.setState({uploading:!1}),a(!0)}))}}))}e.preventDefault()},t.imageUpload=function(){t.fileInput.current.click()},t.addUser=function(){var e,a,n,r,o,l,s;return i.a.async((function(c){for(;;)switch(c.prev=c.next){case 0:if(e=t.props.addUser,a=t.state.inputValues,n=a.email,r=a.name,o=a.password,I.a.isEmail(n)){c.next=5;break}return t.setState({isError:!0}),c.abrupt("return");case 5:return c.next=7,i.a.awrap(document.getElementById("csrf_token").value);case 7:l=c.sent,(s=new FormData).append("email",n),s.append("name",r),s.append("password",o),s.append("csrf_token",l),fetch("http://localhost:5000/addDeviceFromDrawMap",{method:"POST",body:s}).then((function(a){a.json().then((function(a){void 0!==a.err?alert(a.err):(t.setState({addUserOpened:!1}),e(a.new_user.id,a.new_user.name))}))}));case 14:case"end":return c.stop()}}))},t.change=function(e,a){var n=t.state.inputValues;"email"===e&&I.a.isEmail(a)?t.setState({inputValues:Object(c.a)({},n,Object(v.a)({},e,a)),isError:!1}):t.setState({inputValues:Object(c.a)({},n,Object(v.a)({},e,a))})},t.openAddUserModal=function(){t.setState({addUserOpened:!0})},t.closeAddUserModal=function(){t.setState({addUserOpened:!1})},t}return Object(h.a)(a,e),Object(u.a)(a,[{key:"componentDidMount",value:function(){var e;return i.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:e=this.props,this.setState({users:e,addUserOpened:!1});case 2:case"end":return a.stop()}}),null,this)}},{key:"componentDidUpdate",value:function(e,a,t){if(this.state.isError){var n=document.getElementsByClassName("error");console.log("all: ",n);var r=!0,o=!1,l=void 0;try{for(var s,i=n[Symbol.iterator]();!(r=(s=i.next()).done);r=!0){s.value.style.fontSize="inherit"}}catch(c){o=!0,l=c}finally{try{r||null==i.return||i.return()}finally{if(o)throw l}}}}},{key:"render",value:function(){var e=this,a=this.props,t=a.showImageHandler,n=a.selectedTool,o=a.selectTool,l=a.saveShape,s=a.selectUser,i=a.selectedUser,c=a.users,d=this.state,p=d.isError,u=d.inputValues,y=d.addUserOpened;return r.a.createElement(m.a,{icon:!0,style:{border:"0px"}},r.a.createElement(m.a.Item,{style:{backgroundColor:"#4d3a5b",color:"#fff"},name:"Tools",content:"Tools"}),r.a.createElement(m.a.Item,{style:"polygon"===n?{backgroundColor:"#60a",color:"#fff"}:{backgroundColor:"#fff",color:"#60a"},name:"polygon",content:"",icon:"gem",onClick:o}),r.a.createElement(m.a.Item,{style:"rectangle"===n?{backgroundColor:"#60a",color:"#fff"}:{backgroundColor:"#fff",color:"#60a"},name:"rectangle",content:"",icon:"square full",onClick:o}),r.a.createElement(m.a.Item,{style:"circle"===n?{backgroundColor:"#60a",color:"#fff"}:{backgroundColor:"#fff",color:"#60a"},name:"circle",content:"",icon:"circle",onClick:o}),r.a.createElement(m.a.Item,{style:"raspberry"===n?{backgroundColor:"#60a",color:"#fff"}:{backgroundColor:"#fff",color:"#60a"},name:"raspberry",content:"",onClick:o},r.a.createElement(S.a,{icon:O.a})),"raspberry"===n?r.a.createElement(w.a,{item:!0,text:"{}"===JSON.stringify(i)?"Choose User":i.name},r.a.createElement(w.a.Menu,null,r.a.createElement(b.a,{style:{top:"auto",left:"auto",height:"auto"},trigger:r.a.createElement(w.a.Item,{onClick:this.openAddUserModal},"Add Employee"),open:y,onClose:this.closeAddUserModal},r.a.createElement(b.a.Header,null,"Add Employee"),r.a.createElement(b.a.Content,null,r.a.createElement(b.a.Description,null,r.a.createElement(x.a,null,r.a.createElement(x.a.Group,{widths:"equal"},r.a.createElement(x.a.Input,{fluid:!0,label:"Name",placeholder:"Name",autoComplete:"off",value:u.name,onChange:function(a,t){var n=t.value;return e.change("name",n)}}),r.a.createElement(x.a.Field,{id:"form-input-control-error-email",control:x.a.Input,label:"Email",placeholder:"example@deepfocuswork.com",error:p?{content:"Please enter a valid email address",pointing:"above"}:null,autoComplete:"off",value:u.email,onChange:function(a,t){var n=t.value;return e.change("email",n)}}),r.a.createElement(x.a.Input,{label:"Enter Password",type:"password",autoComplete:"off",value:u.password,onChange:function(a,t){var n=t.value;return e.change("password",n)}}),r.a.createElement(x.a.Button,{color:"green",style:{"margin-top":"23px"},onClick:this.addUser},"Add")))))),c.map((function(e){return r.a.createElement(w.a.Item,{onClick:function(){return s(e.userId,e.name)}},e.name)})))):null,"polygon"===n?r.a.createElement(m.a.Item,{style:{backgroundColor:"#fff",color:"#4d3a5b"},name:"undo",content:"",icon:"undo",onClick:this.handleUndo}):null,r.a.createElement(m.a.Item,{style:{backgroundColor:"#4d3a5b",color:"#fff"},name:"refresh",content:"",icon:"refresh",onClick:this.handleClear}),r.a.createElement(m.a.Item,{style:{backgroundColor:"#4d3a5b",color:"#fff"},name:"image",content:"",icon:"image",onClick:t}),r.a.createElement(m.a.Item,{style:{backgroundColor:"#4d3a5b",color:"#fff"},name:"save",content:"",icon:"save",onClick:l}),r.a.createElement(m.a.Item,{style:{backgroundColor:"#4d3a5b",color:"#fff"},name:"upload",content:"",onClick:this.imageUpload},r.a.createElement(k.a,{name:"upload"}),r.a.createElement("input",{type:"file",id:"single",ref:this.fileInput,onChange:this.onChange,hidden:!0})))}}]),a}(n.PureComponent),R=t(20),U=t.n(R),j="M372 232.5l-3.7-6.5c.1-46.4-21.4-65.3-46.5-79.7 7.6-2 15.4-3.6 17.6-13.2 13.1-3.3 15.8-9.4 17.1-15.8 3.4-2.3 14.8-8.7 13.6-19.7 6.4-4.4 10-10.1 8.1-18.1 6.9-7.5 8.7-13.7 5.8-19.4 8.3-10.3 4.6-15.6 1.1-20.9 6.2-11.2.7-23.2-16.6-21.2-6.9-10.1-21.9-7.8-24.2-7.8-2.6-3.2-6-6-16.5-4.7-6.8-6.1-14.4-5-22.3-2.1-9.3-7.3-15.5-1.4-22.6.8C271.6.6 269 5.5 263.5 7.6c-12.3-2.6-16.1 3-22 8.9l-6.9-.1c-18.6 10.8-27.8 32.8-31.1 44.1-3.3-11.3-12.5-33.3-31.1-44.1l-6.9.1c-5.9-5.9-9.7-11.5-22-8.9-5.6-2-8.1-7-19.4-3.4-4.6-1.4-8.9-4.4-13.9-4.3-2.6.1-5.5 1-8.7 3.5-7.9-3-15.5-4-22.3 2.1-10.5-1.3-14 1.4-16.5 4.7-2.3 0-17.3-2.3-24.2 7.8C21.2 16 15.8 28 22 39.2c-3.5 5.4-7.2 10.7 1.1 20.9-2.9 5.7-1.1 11.9 5.8 19.4-1.8 8 1.8 13.7 8.1 18.1-1.2 11 10.2 17.4 13.6 19.7 1.3 6.4 4 12.4 17.1 15.8 2.2 9.5 10 11.2 17.6 13.2-25.1 14.4-46.6 33.3-46.5 79.7l-3.7 6.5c-28.8 17.2-54.7 72.7-14.2 117.7 2.6 14.1 7.1 24.2 11 35.4 5.9 45.2 44.5 66.3 54.6 68.8 14.9 11.2 30.8 21.8 52.2 29.2C159 504.2 181 512 203 512h1c22.1 0 44-7.8 64.2-28.4 21.5-7.4 37.3-18 52.2-29.2 10.2-2.5 48.7-23.6 54.6-68.8 3.9-11.2 8.4-21.3 11-35.4 40.6-45.1 14.7-100.5-14-117.7zm-22.2-8c-1.5 18.7-98.9-65.1-82.1-67.9 45.7-7.5 83.6 19.2 82.1 67.9zm-43 93.1c-24.5 15.8-59.8 5.6-78.8-22.8s-14.6-64.2 9.9-80c24.5-15.8 59.8-5.6 78.8 22.8s14.6 64.2-9.9 80zM238.9 29.3c.8 4.2 1.8 6.8 2.9 7.6 5.4-5.8 9.8-11.7 16.8-17.3 0 3.3-1.7 6.8 2.5 9.4 3.7-5 8.8-9.5 15.5-13.3-3.2 5.6-.6 7.3 1.2 9.6 5.1-4.4 10-8.8 19.4-12.3-2.6 3.1-6.2 6.2-2.4 9.8 5.3-3.3 10.6-6.6 23.1-8.9-2.8 3.1-8.7 6.3-5.1 9.4 6.6-2.5 14-4.4 22.1-5.4-3.9 3.2-7.1 6.3-3.9 8.8 7.1-2.2 16.9-5.1 26.4-2.6l-6 6.1c-.7.8 14.1.6 23.9.8-3.6 5-7.2 9.7-9.3 18.2 1 1 5.8.4 10.4 0-4.7 9.9-12.8 12.3-14.7 16.6 2.9 2.2 6.8 1.6 11.2.1-3.4 6.9-10.4 11.7-16 17.3 1.4 1 3.9 1.6 9.7.9-5.2 5.5-11.4 10.5-18.8 15 1.3 1.5 5.8 1.5 10 1.6-6.7 6.5-15.3 9.9-23.4 14.2 4 2.7 6.9 2.1 10 2.1-5.7 4.7-15.4 7.1-24.4 10 1.7 2.7 3.4 3.4 7.1 4.1-9.5 5.3-23.2 2.9-27 5.6.9 2.7 3.6 4.4 6.7 5.8-15.4.9-57.3-.6-65.4-32.3 15.7-17.3 44.4-37.5 93.7-62.6-38.4 12.8-73 30-102 53.5-34.3-15.9-10.8-55.9 5.8-71.8zm-34.4 114.6c24.2-.3 54.1 17.8 54 34.7-.1 15-21 27.1-53.8 26.9-32.1-.4-53.7-15.2-53.6-29.8 0-11.9 26.2-32.5 53.4-31.8zm-123-12.8c3.7-.7 5.4-1.5 7.1-4.1-9-2.8-18.7-5.3-24.4-10 3.1 0 6 .7 10-2.1-8.1-4.3-16.7-7.7-23.4-14.2 4.2-.1 8.7 0 10-1.6-7.4-4.5-13.6-9.5-18.8-15 5.8.7 8.3.1 9.7-.9-5.6-5.6-12.7-10.4-16-17.3 4.3 1.5 8.3 2 11.2-.1-1.9-4.2-10-6.7-14.7-16.6 4.6.4 9.4 1 10.4 0-2.1-8.5-5.8-13.3-9.3-18.2 9.8-.1 24.6 0 23.9-.8l-6-6.1c9.5-2.5 19.3.4 26.4 2.6 3.2-2.5-.1-5.6-3.9-8.8 8.1 1.1 15.4 2.9 22.1 5.4 3.5-3.1-2.3-6.3-5.1-9.4 12.5 2.3 17.8 5.6 23.1 8.9 3.8-3.6.2-6.7-2.4-9.8 9.4 3.4 14.3 7.9 19.4 12.3 1.7-2.3 4.4-4 1.2-9.6 6.7 3.8 11.8 8.3 15.5 13.3 4.1-2.6 2.5-6.2 2.5-9.4 7 5.6 11.4 11.5 16.8 17.3 1.1-.8 2-3.4 2.9-7.6 16.6 15.9 40.1 55.9 6 71.8-29-23.5-63.6-40.7-102-53.5 49.3 25 78 45.3 93.7 62.6-8 31.8-50 33.2-65.4 32.3 3.1-1.4 5.8-3.2 6.7-5.8-4-2.8-17.6-.4-27.2-5.6zm60.1 24.1c16.8 2.8-80.6 86.5-82.1 67.9-1.5-48.7 36.5-75.5 82.1-67.9zM38.2 342c-23.7-18.8-31.3-73.7 12.6-98.3 26.5-7 9 107.8-12.6 98.3zm91 98.2c-13.3 7.9-45.8 4.7-68.8-27.9-15.5-27.4-13.5-55.2-2.6-63.4 16.3-9.8 41.5 3.4 60.9 25.6 16.9 20 24.6 55.3 10.5 65.7zm-26.4-119.7c-24.5-15.8-28.9-51.6-9.9-80s54.3-38.6 78.8-22.8 28.9 51.6 9.9 80c-19.1 28.4-54.4 38.6-78.8 22.8zM205 496c-29.4 1.2-58.2-23.7-57.8-32.3-.4-12.7 35.8-22.6 59.3-22 23.7-1 55.6 7.5 55.7 18.9.5 11-28.8 35.9-57.2 35.4zm58.9-124.9c.2 29.7-26.2 53.8-58.8 54-32.6.2-59.2-23.8-59.4-53.4v-.6c-.2-29.7 26.2-53.8 58.8-54 32.6-.2 59.2 23.8 59.4 53.4v.6zm82.2 42.7c-25.3 34.6-59.6 35.9-72.3 26.3-13.3-12.4-3.2-50.9 15.1-72 20.9-23.3 43.3-38.5 58.9-26.6 10.5 10.3 16.7 49.1-1.7 72.3zm22.9-73.2c-21.5 9.4-39-105.3-12.6-98.3 43.9 24.7 36.3 79.6 12.6 98.3z",T=function(e){function a(e){var t;return Object(p.a)(this,a),(t=Object(y.a)(this,Object(g.a)(a).call(this,e))).drawShapes=function(){var e,a,n,r,o,l,s,d,p,u,y,g;return i.a.async((function(h){for(;;)switch(h.prev=h.next){case 0:if(e=t.state.layer,a=t.props,n=a.shapes,r=a.showImage,o=a.image,null===e){h.next=32;break}return h.next=5,i.a.awrap(e.destroyChildren());case 5:if(!r||!o){h.next=8;break}return h.next=8,i.a.awrap(U.a.Image.fromURL(o,(function(a){return i.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,i.a.awrap(e.add(a));case 2:return a.zIndex(0),t.next=5,i.a.awrap(e.draw());case 5:case"end":return t.stop()}}))})));case 8:for(l=!0,s=!1,d=void 0,h.prev=11,p=n[Symbol.iterator]();!(l=(u=p.next()).done);l=!0)!1===(y=u.value).isSaved?"polygon"===y.type?e.add(new U.a.Line({points:y.shape,stroke:"red",fill:"red",closed:!0,draggable:!0,opacity:.6})):"rectangle"===y.type?e.add(new U.a.Rect(Object(c.a)({},y.shape,{stroke:"red",fill:"red",opacity:.6}))):"circle"===y.type?e.add(new U.a.Ring(Object(c.a)({},y.shape,{stroke:"red",fill:"red",opacity:.6}))):"raspberry"===y.type&&e.add(new U.a.Path(Object(c.a)({},y.shape,{fill:"red",scaleX:.05,scaleY:.05,data:j}))):"polygon"===y.type?e.add(new U.a.Line({points:y.shape,stroke:"yellow",fill:"yellow",closed:!0,draggable:!0,opacity:.6})):"rectangle"===y.type?e.add(new U.a.Rect(Object(c.a)({},y.shape,{stroke:"green",fill:"green",opacity:.6}))):"circle"===y.type?e.add(new U.a.Ring(Object(c.a)({},y.shape,{stroke:"blue",fill:"blue",opacity:.6}))):"raspberry"===y.type&&e.add(new U.a.Path(Object(c.a)({},y.shape,{fill:"purple",scaleX:.05,scaleY:.05,data:j})));h.next=19;break;case 15:h.prev=15,h.t0=h.catch(11),s=!0,d=h.t0;case 19:h.prev=19,h.prev=20,l||null==p.return||p.return();case 22:if(h.prev=22,!s){h.next=25;break}throw d;case 25:return h.finish(22);case 26:return h.finish(19);case 27:e.draw(),void 0!==(g=e.findOne("#xxx"))&&g.destroy(),t.point=null,t.line=null;case 32:case"end":return h.stop()}}),null,null,[[11,15,19,27],[20,,22,26]])},t.point=null,t.line=null,t.circleDrawHandler=function(e){var a=t.state.layer,n=a.findOne("#xxx");if(void 0===n){var r=new U.a.Ring({id:"xxx",x:e.evt.layerX,y:e.evt.layerY,outerRadius:0,innerRadius:3,fill:"red",stroke:"black",strokeWidth:0});a.add(r)}else n.setAttrs({x:e.evt.layerX,y:e.evt.layerY});var o=a.findOne("#circle");void 0!==o&&(console.log(e.evt.layerX,o.attrs.x,".",e.evt.layerY,o.attrs.y,Math.sqrt(Math.pow(e.evt.layerX-o.attrs.x,2)+Math.pow(e.evt.layerY-o.attrs.y,2)),o),o.setAttrs({innerRadius:Math.sqrt(Math.pow(e.evt.layerX-o.attrs.x,2)+Math.pow(e.evt.layerY-o.attrs.y,2))})),a.draw()},t.rectangleDrawHandler=function(e){var a=t.state.layer;if(void 0!==a.findOne("#xxx")){if(a.findOne("#xxx").setAttrs({x:e.evt.layerX,y:e.evt.layerY}),void 0!==a.findOne("#rectangle"))a.findOne("#rectangle").setAttrs({width:e.evt.layerX-t.rectangle.x,height:e.evt.layerY-t.rectangle.y});else if(void 0!==t.rectangle.x&&void 0!==t.rectangle.y){var n=new U.a.Rect({id:"rectangle",x:t.rectangle.x,y:t.rectangle.y,width:e.evt.layerX-t.rectangle.x,height:e.evt.layerY-t.rectangle.y,stroke:"red"});a.add(n)}}else{var r=new U.a.Ring(Object(c.a)({id:"xxx"},t.point,{outerRadius:0,innerRadius:3,fill:"red",stroke:"black",strokeWidth:0}));a.add(r)}a.draw()},t.polygonDrawHandler=function(e){var a=t.state.layer;if(null===t.point){t.point={x:e.evt.layerX,y:e.evt.layerY};var n=new U.a.Ring(Object(c.a)({id:"xxx"},t.point,{outerRadius:0,innerRadius:3,fill:"red",stroke:"black",strokeWidth:0}));a.add(n)}if(null===t.line&&t.polygon.length>0){t.line=[t.polygon[t.polygon.length-2],t.polygon[t.polygon.length-1],e.evt.layerX,e.evt.layerY];var r=new U.a.Line({id:"xxy",points:[t.polygon[t.polygon.length-2],t.polygon[t.polygon.length-1],e.evt.layerX,e.evt.layerY],stroke:"red"});a.add(r)}void 0!==a.findOne("#xxx")&&a.findOne("#xxx").setAttrs({x:e.evt.layerX,y:e.evt.layerY}),t.polygon.length>0&&void 0!==a.findOne("#xxy")&&a.findOne("#xxy").setAttrs({points:[t.point.x,t.point.y,e.evt.layerX,e.evt.layerY]}),a.draw()},t.raspberryDrawHandler=function(e){var a=t.props.selectedUser,n=t.state.layer;if(a.userId){var r=n.findOne("#raspberry");if(r)r.setAttrs({id:"raspberry",x:e.evt.layerX-10,y:e.evt.layerY-10,data:j,fill:"red",scaleX:.05,scaleY:.05}),n.draw();else{var o=new U.a.Path({id:"raspberry",x:e.evt.layerX-10,y:e.evt.layerY-10,data:j,fill:"red",scaleX:.05,scaleY:.05});console.log(o),n.add(o),n.draw()}}},t.mouseMoveHandler=function(e){var a=t.props.selectedTool;"polygon"===a?t.polygonDrawHandler(e):"rectangle"===a?t.rectangleDrawHandler(e):"circle"===a?t.circleDrawHandler(e):"raspberry"===a&&t.raspberryDrawHandler(e)},t.rectangle={},t.polygon=[],t.oldTarget=null,t.mouseUpHandler=function(e){t.line=null;var a=t.state,n=a.layer,r=a.deviceLimit,o=t.props,l=o.isReadyToSaveHaveHandler,s=o.selectedTool,i=o.changeShape,c=o.shapes,p=o.selectedUser;o.removeShape;if(null!==s){if("select"===s){if(null!==t.oldTarget&&void 0!==t.oldTarget){if(e.target._id===t.oldTarget._id)return;t.oldTarget.setAttrs({stroke:"yellow"})}t.oldTarget=e.target,e.target.setAttrs({stroke:"red"});var u=new U.a.Transformer;return n.add(u),u.attachTo(e.target),e.target.on("transform",(function(){console.log(e.target.parent,u.parent)})),void n.draw()}var y=new U.a.Ring({x:e.evt.layerX,y:e.evt.layerY,outerRadius:0,innerRadius:5,fill:"red",stroke:"black",strokeWidth:0});if("polygon"===s)if(t.point={x:e.evt.layerX,y:e.evt.layerY},t.polygon.length>1)if(t.polygon[0]>=e.evt.layerX-5&&t.polygon[0]<=e.evt.layerX+5&&t.polygon[1]>=e.evt.layerY-5&&t.polygon[1]<=e.evt.layerY+5){var g=new U.a.Line({points:[t.polygon[t.polygon.length-2],t.polygon[t.polygon.length-1],t.polygon[0],t.polygon[1]],stroke:"red"});n.add(g),y.setAttrs({x:t.polygon[0],y:t.polygon[1]}),i([].concat(Object(d.a)(t.polygon),[t.polygon[0],t.polygon[1]])),t.point=null,t.line=null,t.polygon=[],l(!0)}else{var h=new U.a.Line({points:[t.polygon[t.polygon.length-2],t.polygon[t.polygon.length-1],e.evt.layerX,e.evt.layerY],stroke:"red"});n.add(h),t.polygon.push(e.evt.layerX,e.evt.layerY)}else t.polygon.push(e.evt.layerX,e.evt.layerY);else if("rectangle"===s)if(void 0===t.rectangle.x||void 0===t.rectangle.y)t.rectangle={x:e.evt.layerX,y:e.evt.layerY},console.log(t.rectangle);else{var f=new U.a.Rect({x:t.rectangle.x,y:t.rectangle.y,width:e.evt.layerX-t.rectangle.x,height:e.evt.layerY-t.rectangle.y,stroke:"red"});n.add(f),i({x:t.rectangle.x,y:t.rectangle.y,width:e.evt.layerX-t.rectangle.x,height:e.evt.layerY-t.rectangle.y}),t.point=null,t.rectangle={},l(!0)}else if("circle"===s){var v=n.findOne("#circle");if(void 0===v){var m=new U.a.Ring({id:"circle",x:e.evt.layerX,y:e.evt.layerY,outerRadius:0,innerRadius:5,stroke:"red"});n.add(m)}else{var w=new U.a.Ring({x:v.attrs.x,y:v.attrs.y,outerRadius:0,innerRadius:Math.sqrt(Math.pow(e.evt.layerX-v.attrs.x,2)+Math.pow(e.evt.layerY-v.attrs.y,2)),stroke:"red"});n.add(w),i({x:v.attrs.x,y:v.attrs.y,innerRadius:Math.sqrt(Math.pow(e.evt.layerX-v.attrs.x,2)+Math.pow(e.evt.layerY-v.attrs.y,2))}),t.point=null,t.rectangle={},l(!0)}}else if("raspberry"===s){if(void 0===p.userId)return;if(c.filter((function(e){return"raspberry"===e.type})).length>=r)return;i({x:e.evt.layerX-10,y:e.evt.layerY-10}),l(!0)}n.add(y),n.draw()}},t.state={stage:null,layer:null,shapes:[],deviceLimit:0},t}return Object(h.a)(a,e),Object(u.a)(a,[{key:"componentDidMount",value:function(){var e,a,t,n;return i.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:return e=this.props.shapes,r.next=3,i.a.awrap(document.getElementById("deviceLimit").value);case 3:a=r.sent,t=new U.a.Stage({width:window.innerWidth,height:window.innerHeight-40,container:"#containerForStage",visible:!0}),n=new U.a.Layer({}),t.add(n),t.on("mouseup",this.mouseUpHandler),t.on("mousemove",this.mouseMoveHandler),this.setState({stage:t,layer:n,shapes:e,deviceLimit:a});case 10:case"end":return r.stop()}}),null,this)}},{key:"render",value:function(){return console.log("rendering....",this.props),this.drawShapes(),null}}]),a}(n.PureComponent),X=function(e){function a(e){var t;return Object(p.a)(this,a),(t=Object(y.a)(this,Object(g.a)(a).call(this,e))).isReadyToSaveHaveHandler=function(e){t.setState({isReadyToSave:e})},t.selectTool=function(e,a){var n=a.name;t.setState({selectedTool:n})},t.changeImage=function(e,a,n){return new Promise((function(r){t.setState({image:e,base64image:a,filename:n}),r(e)}))},t.shape=[],t.changeShape=function(e){var a=t.state,n=a.selectedTool,r=a.shapes,o=a.selectedUser;console.log("shape",r,t.state),"raspberry"===n?t.setState({shapes:[].concat(Object(d.a)(r.filter((function(e){return"raspberry"!==e.type||e.type===n&&e.id!==o.userId}))),[{id:o.userId,type:n,isSaved:!1,shape:e}])}):t.setState({shapes:[].concat(Object(d.a)(r),[{type:n,isSaved:!1,shape:e}])})},t.saveShape=function(){var e,a,n,r,o,l,s,p,u;return i.a.async((function(y){for(;;)switch(y.prev=y.next){case 0:if(e=t.state,a=e.isReadyToSave,n=e.shapes,r=e.image,o=e.base64image,l=e.filename,!a){y.next=13;break}return y.next=4,i.a.awrap(document.getElementById("csrf_token").value);case 4:s=y.sent,p=n.map((function(e){return Object(c.a)({},e,{isSaved:!0})})),(u=new FormData).append("csrf_token",s),u.append("shapes",JSON.stringify(p)),null!==r?(u.append("doesImageExist","true"),u.append("filename",l),u.append("base64image",o)):u.append("doesImageExist","false"),fetch("http://localhost:5000/upload",{method:"POST",body:u}).then((function(e){e.json().then((function(e){t.setState({imageURL:"http://localhost:5000/".concat(e.file),shapes:Object(d.a)(p)})}))})).catch((function(e){null!==r&&alert("can not be uploaded:( ".concat(e," )"))})),y.next=14;break;case 13:alert("not ready to save");case 14:case"end":return y.stop()}}))},t.showImageHandler=function(){var e=t.state.showImage;t.setState({showImage:!e})},t.selectUser=function(e,a){t.setState({selectedUser:{userId:e,name:a}})},t.addUser=function(e,a){var n=t.state.users;t.setState({users:[].concat(Object(d.a)(n),[{userId:e,name:a}])})},t.state={selectedTool:null,isReadyToSave:!1,shapes:[],image:null,showImage:!0,base64image:null,filename:null,selectedUser:{}},t}return Object(h.a)(a,e),Object(u.a)(a,[{key:"componentDidMount",value:function(){var e=JSON.parse(document.getElementById("containerForStage").getAttribute("shapes").split("'").join('"')),a=document.getElementById("containerForStage").getAttribute("image"),t=document.getElementById("users").value;t=JSON.parse(t.split("'").join('"')),this.setState({selectedTool:null,isReadyToSave:!1,users:t,image:a,shapes:e})}},{key:"render",value:function(){var e=this.state,a=e.selectedTool,t=e.shapes,n=e.image,o=e.showImage,s=e.selectedUser,i=e.users;return l.a.render(r.a.createElement(C,{isReadyToSaveHaveHandler:this.isReadyToSaveHaveHandler,showImageHandler:this.showImageHandler,selectTool:this.selectTool,selectedTool:a,saveShape:this.saveShape,changeImage:this.changeImage,addUser:this.addUser,selectUser:this.selectUser,selectedUser:s,users:i}),document.getElementById("tools")),l.a.render(r.a.createElement(T,{isReadyToSaveHaveHandler:this.isReadyToSaveHaveHandler,changeShape:this.changeShape,selectedTool:a,shapes:t,image:n,showImage:o,selectedUser:s,removeShape:this.removeShape}),document.getElementById("containerForStage")),null}}]),a}(n.PureComponent);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));t(566);l.a.render(r.a.createElement(X,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[280,1,2]]]);
//# sourceMappingURL=main.c038047b.chunk.js.map